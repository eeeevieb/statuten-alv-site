<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statuten-ALV voortgang</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column; /* Stack elements vertically */
            align-items: center;
            padding-top: 10px;
            background-color: #9F81BA;
        }
         /* Style the buttons that are used to open and close the accordion panel */
        .accordion {
            background-color: #588c92;
            color: #eee;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            transition: 0.4s;
        }
        
        /* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
        .accordion:hover {
            background-color: #ccc;
        }

        .active {
            background-color: #789fa3;   
        }
        
        /* Style the accordion panel. Note: hidden by default */
        .panel {
            padding: 0 18px;
            background-color: rgb(235, 235, 235);
            display: none;
            overflow: hidden;
        } 
    </style>
</head>
<body>
    <p><a href="index.html">NL</a></p>
    <div class="container">
        <!-- <p>
            We hebben op dit moment 79 leden in de vereniging. Er moet tweederde daarvan gerepresenteerd zijn op de ALV. Dat zijn 56 mensen.
        </p> -->
        <h1>Help us change our statutes!</h1>
        <p class="amount-members" id = "amountMembers">Loading count...</p>
        <!-- <p class="members-needed" id="membersNeeded">Loading count...</p> -->
        <!-- <p class="people-count" id="peopleCount">Loading count...</p> -->
        <p> </p>
    <!-- </div>
    <div class="container">
        <h1>Current Progress</h1> -->

        <!-- Progress Bar Area -->
        <div class="progress-container">
            <div class="progress-bar-background">
                <div class="progress-bar-value" id="progressBar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <!-- Optional: Text inside the bar -->
                    <!-- <span id="progressTextInner">0%</span> -->
                </div>
            </div>
        </div>

        <!-- Percentage Text Area -->
        <div class="progress-percentage-text" id="percentageText">Loading...</div>
        <div id="errorDisplay" class="error"></div>
    </div>
    <div class="container">
        <h2>How can I help?</h2>
        <p>You can come by yourself on May 19th at 19:30 in the Krater — just sign up on <a href="https://kiwi.particolarte.nl/activity/0195b56d-a763-7397-88a0-a2010992658e" target="_blank" >Kiwi</a>. If you can’t make it, you can authorize someone else to vote for you by emailing <a href="mailto:secretaris@particolarte.nl?subject=Machtiging%20statuten-ALV&body=Hoi%20secretaris!%0A%0AIk%20wil%20graag%20%5BINSERT%20NAAM%5D%20machtigen%20voor%20de%20statuten-ALV." target="_blank">secretaris@particolarte.nl</a>. You can see who’s attending on <a href="https://kiwi.particolarte.nl/activity/0195b56d-a763-7397-88a0-a2010992658e" target="_blank" >Kiwi</a>. No need to wait to authorize someone — you can do it right away!
        </p>
    </div>
    <break></break>
    <div class="container">
        <h2>Q&A</h2>
        <button class="accordion">What are the statutes?</button>
        <div class="panel">
            <p>The statutes contain the most important rules of the association. So basically Particolarte’s constitution. They include things like the purpose of the association, rules about membership and general meetings, and, for example, how the statutes themselves can be amended. As you probably know by now, changing the statutes requires a turnout quorum of two-thirds of the members. </p>
        </div>
        <button class="accordion">Why are we changing the statutes?</button>
        <div class="panel">
            <p>In 2021, the Management and Supervision of Legal Entities Act (WBTR) was passed. This law requires that our statutes include a provision outlining what happens in the event of a long-term absence or inability to act on the part of the board (belet and ontstentenis). This clause is currently missing from our statutes. That’s why a revision is now necessary to ensure we comply with the law.
                Additionally, our statutes haven’t been updated since the association was founded — so this is also a great opportunity to give them a much-needed refresh.</p>
        </div>
        <button class="accordion">Was there also something happening with HR?</button>
        <div class="panel">
            <p>Since we’re already in the process of updating official documents, we’re also taking this opportunity to revise our Internal Regulations (HR). The HR is easier to change than the statutes — it only requires a majority vote at a General Meeting, without a quorum.
                We’ve updated the HR to align with the new statutes and to reflect the current practices within the association. So we’ll also be voting on the updated HR during this GM.</p>
        </div>
        <button class="accordion">How will the statutes GM work?</button>
        <div class="panel">
            <p>The revised versions of the statutes and HR will be sent to you well in advance. We kindly ask you to read through them beforehand and send any discussion points to us by May 15 at the latest (<a href="mailto:bestuurd@particolarte.nl">bestuur@particolarte.nl</a>). Our goal is to make the General Meeting as efficient as possible, so we will only discuss points that have been submitted in advance. This means that <b>no</b> new discussion points can be raised during the meeting itself. During the GM, we will go over the submitted feedback, and hopefully vote to adopt the new statutes and HR — and then move on to the borrel!</p>
        </div>
        <button class="accordion">What language will be used?</button>
        <div class="panel">
            <p>As we have already voted in the content of the changes last year, and we will only be discussing the language of the statutes at this GM, the documents will not be translated to English. The GM will also be in Dutch. Because it can be distracting if someone talks through the meeting, we can unfortunately not translate live. However, if you do have discussion points, you can send them to us by email before the deadline and we will discuss them at the GM.</p>
        </div>
        <button class="accordion">Are there more ways to help?</button>
        <div class="panel">
            <p>Always! First of all, you can ask other particonauts if they’ve already authorized someone to vote on their behalf (and don’t let them go until they’ve sent the email). You can organize a statute-reading session. You can stand on the bar in the Krater and shout at people to come to the ALV. You could even snatch someone’s phone and send an authorization email to the secretary yourself—wait, actually, don’t do that. People do need to send the email themselves.
                And finally, you can say something nice to the statutes working group, because they’ve been working on these statutes for months (years?) so that we as an association can continue to exist :)</p>
        </div>
    </div>
    <div class="container">
        <p>Note: I myself am at the back-end of this website. The meter will only update once I’ve checked my email or looked at Kiwi, hehe.</p>
        <p>xo your loveliest secretary</p>
    </div>
    <script>
        // --- Configuration ---
        // !! IMPORTANT !! Replace with YOUR *CSV* publish URL
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRUcIyqcUhGu8oHtG4Pw8fHvVdH6YibbYN77EcGEZqbZ_vM8fdcWvjQQYb8rzZCvZMHp67QBlbj0mts/pub?output=csv';

        // !! IMPORTANT !! Adjust indices for your specific cells
        // Percentage Cell (e.g., H6)
        const PERCENTAGE_ROW_INDEX = 7; // Row 6 is index 5
        const PERCENTAGE_COL_INDEX = 0; // Column H is index 7

        // People Count Cell (e.g., I6)
        const COUNT_ROW_INDEX = 1;    // Row 6 is index 5 (Same row as percentage)
        const COUNT_COL_INDEX = 0;    // Column I is index 8

        const MEM_ROW_INDEX = 15;
        const MEM_COL_INDEX = 0;

        const NEED_ROW_INDEX = 4;
        const NEED_COL_INDEX = 0;

        const POLLING_INTERVAL_MS = 15000; // Check every 15 seconds

        // --- End Configuration ---

        const progressBarElement = document.getElementById('progressBar');
        const percentageTextElement = document.getElementById('percentageText');
        const peopleCountElement = document.getElementById('peopleCount'); // Get reference to new paragraph
        const amountMembersElement = document.getElementById('amountMembers');
        const membersNeededElement = document.getElementById('membersNeeded');
        const errorElement = document.getElementById('errorDisplay');

        // Renamed function to reflect it fetches multiple data points
        async function fetchAndUpdateData() {
            console.log('Fetching data...');
            errorElement.textContent = ''; // Clear previous errors
            // Set loading states
            // if (!percentageTextElement.textContent.includes('%')) percentageTextElement.textContent = 'Updating...';
            // if (!peopleCountElement.textContent.includes('people')) peopleCountElement.textContent = 'Updating count...';


            try {
                const response = await fetch(SHEET_URL + '&cachebust=' + new Date().getTime());
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const text = await response.text();
                const rows = text.split('\n');

                // --- Extract Percentage ---
                let percentageValue = null;
                if (rows.length > PERCENTAGE_ROW_INDEX) {
                    const cols = rows[PERCENTAGE_ROW_INDEX].split(',');
                    if (cols.length > PERCENTAGE_COL_INDEX) {
                        percentageValue = cols[PERCENTAGE_COL_INDEX].replace(/^"|"$/g, ''); // Clean quotes
                    } else {
                        throw new Error(`Percentage column index ${PERCENTAGE_COL_INDEX} out of bounds.`);
                    }
                } else {
                    throw new Error(`Percentage row index ${PERCENTAGE_ROW_INDEX} out of bounds.`);
                }

                 // --- Extract People Count ---
                let peopleCountValue = null;
                // Ensure the SPECIFIC row for the count exists
                if (rows.length > COUNT_ROW_INDEX) {
                    // *** The Key Fix: Split the CORRECT row string for the count ***
                    const countCols = rows[COUNT_ROW_INDEX].split(',');
                    // Now access the column within that specific row's columns
                    if (countCols.length > COUNT_COL_INDEX) {
                        peopleCountValue = countCols[COUNT_COL_INDEX].replace(/^"|"$/g, '');
                    } else {
                         // Don't throw error here, just log it maybe, or set count to 'N/A'
                         console.warn(`Count column index ${COUNT_COL_INDEX} out of bounds.`);
                         peopleCountValue = 'N/A'; // Indicate count couldn't be found
                    }
                } else {
                    // Don't throw error here, just log it maybe, or set count to 'N/A'
                    console.warn(`Count row index ${COUNT_ROW_INDEX} out of bounds.`);
                    peopleCountValue = 'N/A'; // Indicate count couldn't be found
                }


                // --- Process and Update Percentage ---
                let numericPercentage = NaN;
                if (percentageValue !== null) {
                    numericPercentage = parseFloat(percentageValue.toString().replace('%', ''));
                }
                if (isNaN(numericPercentage)) {
                    console.error(`Invalid percentage data: "${percentageValue}"`); // Log specific error
                    percentageTextElement.textContent = 'Invalid %';
                    progressBarElement.style.width = '0%'; // Reset bar on bad data
                    progressBarElement.setAttribute('aria-valuenow', 0);
                } else {
                     if (Math.abs(numericPercentage) <= 1 && percentageValue.toString().indexOf('%') === -1) {
                         numericPercentage *= 100;
                     }
                     const validPercentage = Math.max(0, Math.min(100, numericPercentage));
                     progressBarElement.style.width = validPercentage + '%';
                     progressBarElement.setAttribute('aria-valuenow', validPercentage.toFixed(1));
                     percentageTextElement.textContent = validPercentage.toFixed(1) + '%';
                     percentageTextElement.classList.remove('loading');
                }

                 // --- Extract People Count ---
                 let amountMembersValue = null;
                // Ensure the SPECIFIC row for the count exists
                if (rows.length > MEM_ROW_INDEX) {
                    // *** The Key Fix: Split the CORRECT row string for the count ***
                    const countCols = rows[MEM_ROW_INDEX].split(',');
                    // Now access the column within that specific row's columns
                    if (countCols.length > MEM_COL_INDEX) {
                        amountMembersValue = countCols[MEM_COL_INDEX].replace(/^"|"$/g, '');
                    } else {
                         // Don't throw error here, just log it maybe, or set count to 'N/A'
                         console.warn(`Count column index ${MEM_COL_INDEX} out of bounds.`);
                         amountMembersValue = 'N/A'; // Indicate count couldn't be found
                    }
                } else {
                    // Don't throw error here, just log it maybe, or set count to 'N/A'
                    console.warn(`Count row index ${MEM_ROW_INDEX} out of bounds.`);
                    amountMembersValue = 'N/A'; // Indicate count couldn't be found
                }

                // --- Extract People Count ---
                let membersNeededValue = null;
                // Ensure the SPECIFIC row for the count exists
                if (rows.length > NEED_ROW_INDEX) {
                    // *** The Key Fix: Split the CORRECT row string for the count ***
                    const countCols = rows[NEED_ROW_INDEX].split(',');
                    // Now access the column within that specific row's columns
                    if (countCols.length > NEED_COL_INDEX) {
                        membersNeededValue = countCols[NEED_COL_INDEX].replace(/^"|"$/g, '');
                    } else {
                         // Don't throw error here, just log it maybe, or set count to 'N/A'
                         console.warn(`Count column index ${NEED_COL_INDEX} out of bounds.`);
                         membersNeededValue = 'N/A'; // Indicate count couldn't be found
                    }
                } else {
                    // Don't throw error here, just log it maybe, or set count to 'N/A'
                    console.warn(`Count row index ${NEED_ROW_INDEX} out of bounds.`);
                    membersNeededValue = 'N/A'; // Indicate count couldn't be found
                }


                // --- Process and Update People Count ---
                 // Basic check if count value looks like a number or is 'N/A'

                 if (amountMembersValue !== null && (amountMembersValue === 'N/A' || !isNaN(parseInt(amountMembersValue)))) {
                     if (amountMembersValue === 'N/A') {
                        amountMembersElement.textContent = 'Count data unavailable.';
                     } else {
                        amountMembersElement.textContent = ` At the moment we have ${amountMembersValue} members in the association. Two-thirds of that need to be represented at the GM. That's ${membersNeededValue} people. At this moment, ${peopleCountValue} people are represented. That's ${numericPercentage}% of the total we need.`;
                     }
                 } else {
                     console.error(`Invalid count data: "${peopleCountValue}"`);
                     amountMembersElement.textContent = 'Invalid count data.';
                 }
                 amountMembersElement.classList.remove('loading'); // Remove loading class if any

                //  if (membersNeededValue !== null && (membersNeededValue === 'N/A' || !isNaN(parseInt(membersNeededValue)))) {
                //      if (membersNeededValue === 'N/A') {
                //          membersNeededElement.textContent = 'Count data unavailable.';
                //      } else {
                //          membersNeededElement.textContent = ` Er moet tweederde daarvan gerepresenteerd zijn op de ALV. Dat zijn ${membersNeededValue} mensen. `;
                //      }
                //  } else {
                //      console.error(`Invalid count data: "${membersNeededValue}"`);
                //      membersNeededElement.textContent = 'Invalid count data.';
                //  }

                //  peopleCountElement.classList.remove('loading'); // Remove loading class if any

                //  if (peopleCountValue !== null && (peopleCountValue === 'N/A' || !isNaN(parseInt(peopleCountValue)))) {
                //      if (peopleCountValue === 'N/A') {
                //          peopleCountElement.textContent = 'Count data unavailable.';
                //      } else {
                //          peopleCountElement.textContent = ` Er zijn op dit moment ${peopleCountValue} mensen gerepresenteerd. Dat is ${numericPercentage}% van het totaal dat we nodig hebben.`;
                //      }
                //  } else {
                //      console.error(`Invalid count data: "${peopleCountValue}"`);
                //      peopleCountElement.textContent = 'Invalid count data.';
                //  }
                //  peopleCountElement.classList.remove('loading'); // Remove loading class if any

            } catch (error) {
                console.error('Failed to fetch or update data:', error);
                // Display general error and reset UI elements
                errorElement.textContent = `Error: ${error.message}`;
                percentageTextElement.textContent = 'Error';
                progressBarElement.style.width = '0%';
                progressBarElement.setAttribute('aria-valuenow', 0);
                peopleCountElement.textContent = 'Count unavailable due to error.'; // Update count display on error
            }
        }

        // Initial fetch
        fetchAndUpdateData();

        // Set up polling
        setInterval(fetchAndUpdateData, POLLING_INTERVAL_MS);

        var acc = document.getElementsByClassName("accordion");
        var i;

        for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function() {
            /* Toggle between adding and removing the "active" class,
            to highlight the button that controls the panel */
            this.classList.toggle("active");

            /* Toggle between hiding and showing the active panel */
            var panel = this.nextElementSibling;
            if (panel.style.display === "block") {
            panel.style.display = "none";
            } else {
            panel.style.display = "block";
            }
        });
        } 

    </script>
</body>
</html>